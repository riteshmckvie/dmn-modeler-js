<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Digital Broker Modeler</title>

    <!-- required modeler styles -->
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/diagram-js.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-js-shared.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-js-drd.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-js-decision-table.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-js-decision-table-controls.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-js-literal-expression.css">
    <link rel="stylesheet" href="https://unpkg.com/dmn-js@8.3.0/dist/assets/dmn-font/css/dmn.css">
	<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,500,700" rel="stylesheet" type="text/css">

    <!-- modeler distro -->
    <script src="https://unpkg.com/dmn-js@8.3.0/dist/dmn-modeler.development.js"></script>
	

    <!-- needed for this example only -->
    <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>

    <!-- example styles -->
    <link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="modeler-style.css">

    <style>
      #save-button {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: white;
        padding: 5px;
        border: solid 1px #CCC;
        border-radius: 2px;
        padding: 8px;
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        cursor: default;
        font-size: 14px;
        color: #444;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <div class="editor-parent">
        <div class="editor-container"></div>
        <div class="editor-tabs"></div>
      </div>
    </div>
	
	
	
	<div class="io-import-export">
	<!--<button id="save-button">print to console</button> -->
		<ul class="io-import io-control io-control-list io-horizontal">
		  <li>
		    <input type="file" id="fileUpload" style="margin-left:4em" hidden/>
			<button title="Open DMN file from local file system" id="fileUploadButton">
			  <svg class="bi bi-folder-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3zm-8.322.12C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139z"/>
			 </svg>
			</button>
		  </li>
		  <li class="vr"></li>
		  <li>
			<button title="Create new DMN diagram" id="newDmn">
			  <svg class="bi bi-plus-circle-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4a.5.5 0 0 0-1 0v3.5H4a.5.5 0 0 0 0 1h3.5V12a.5.5 0 0 0 1 0V8.5H12a.5.5 0 0 0 0-1H8.5V4z"/>
			  </svg>
			</button>
		  </li>
		  <li class="vr"></li>
		  <li>
			<a href="#" class="download" title="download DMN file"  id="download" >
				<svg height="22px" id="Layer_1" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(528 240)"><path d="M-512-220l-8-8h4v-12h8v12h4L-512-220z M-501-230h-2.236l5,10H-504l-4,6h-8l-4-6h-5.764l5-10H-523l-5,10v12h32v-12   L-501-230z"/></g></svg>
			</a>
		  </li>
		  <li class="vr"></li>
		  <li>
			<input type="file" id="fileDeploy" style="margin-left:4em" hidden/>
			<a href="#" title="deploy this DMN"  id="deploy" >
				<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" width="32px" height="22px" viewBox="0 0 512 512" style="enable-background:new 0 0 32 32;" xml:space="preserve">
					<g>
						<g>
							<g>
								<path fill="#020202" d="M204.192,62.194c14.147-20.472,29.339-41.613,50.963-54.72c21.323,12.782,36.366,33.547,50.311,53.656     c32.847,49.754,52.929,109.515,48.878,169.578c10.615,8.898,21.537,17.441,31.994,26.521     c15.011,13.797,22.02,35.319,18.406,55.327c-5.036,25.275-9.876,50.607-15.206,75.813c-2.963,12.968-20.508,18.905-30.823,10.62     c-17.121-14.291-33.816-29.108-50.932-43.417c-12.95,12.462-30.153,20.772-48.214,21.773     c-20.791,1.466-41.375-7.156-56.448-21.242c-12.28,9.401-23.666,20.686-35.664,30.755c-5.799,4.66-10.621,10.784-17.484,13.966     c-10.64,4.565-24.342-2.248-26.747-13.685c-5.479-24.642-11.203-49.24-16.52-73.92c-4.321-20.878,3.332-43.61,19.419-57.607     c9.313-7.822,18.756-15.487,28.243-23.096c2.643-1.39,1.315-4.596,1.465-6.951C153.005,167.614,172.8,110.333,204.192,62.194z      M220.995,138.526c-12.424,15.994-10.921,40.768,3.488,55.052c15.255,16.809,44.15,17.422,60.106,1.29     c12.317-11.253,16.482-30.146,10.603-45.671c-5.387-14.967-19.809-26.195-35.671-27.591     C244.873,119.92,229.706,126.659,220.995,138.526z"/>
							</g>
							<path fill="#020202" d="M198.263,407.819c-0.213-7.266,8.83-12.262,14.942-8.417c25.87,13.32,58.027,13.314,83.896-0.007    c5.937-3.645,14.736,0.733,14.955,7.803c0.087,15.432,0.105,30.88,0.024,46.317c0.119,7.533-9.832,12.337-15.681,7.626    c-4.452-3.926-8.467-8.341-12.75-12.461c-6.776,13.201-13.163,26.602-19.995,39.772c-3.281,6.275-13.533,6.318-16.877,0.105    c-6.87-13.195-13.213-26.676-20.121-39.858c-4.221,4.157-8.248,8.548-12.694,12.468c-5.824,4.734-15.756-0.162-15.675-7.647    C198.163,438.291,198.244,423.055,198.263,407.819z"/>
						</g>
						<circle fill="#020202" cx="254.831" cy="164.509" r="20.812"/>
					</g>
			  </svg>
			</a>
		  </li>
		</ul>
		
	</div>
	
    

    <script>
	var newDiagramUrl = 'https://cdn.statically.io/gh/riteshmckvie/dmn-content/5475db03/new.dmn';
	
	$('#newDmn').on('click',function() {
	
		$.get(newDiagramUrl, openDiagram, 'text');
		
	});
		
	$("#fileUploadButton").on('click',function() {
				
		document.getElementById('fileUpload').click();
		
	});
	
	$("#deploy").on('click',function() {
	
		document.getElementById('fileDeploy').click();
				
	});
	
	$("#fileUpload").on('change',function() {
		
	  var xml;
	  var files = this.files;
	  
   
      if (files && files[0]) {
        const myFile = files[0];
        const reader = new FileReader();

		 reader.addEventListener('load', function (e) {
			xml = e.target.result;
			openDiagram(xml);
			
		});
		reader.readAsBinaryString(myFile);
      }
		
	});
	
	$("#fileDeploy").on('change',function() {
	
	  alert('DMN Diagram imported. Deployment started!');
	  var files = this.files;
	  
      if (files && files[0]) {
       	var formData = new FormData();    
	    formData.append('file', files[0] );

	    $.ajax({
		  url: 'https://run.mocky.io/v3/11f9ddb2-edad-457e-9c63-c40c919b8e12',
		  data: formData,
		  processData: false,
		  contentType: false,
		  type: 'POST',
		  success: function(data){
		    alert(data.status + ' ' + data.message);
		  },
		  error: function(data) {
           alert('Sorry ! This Deployment is failed.Please try again.');
          },
	    });
        
      }
		
	});

      var diagramUrl = 'https://cdn.staticaly.com/gh/bpmn-io/dmn-js-examples/a71e16/starter/diagram.dmn';
	  
      var CLASS_NAMES = {
        drd: 'dmn-icon-lasso-tool',
        decisionTable: 'dmn-icon-decision-table',
        literalExpression: 'dmn-icon-literal-expression'
      };

      var $container = $('.editor-container');
      var $tabs = $('.editor-tabs');

      // modeler instance
      var dmnModeler = new DmnJS({
        container: $container,
        height: 500,
        width: '100%',
        keyboard: {
          bindTo: window
        }
      });

      $tabs.delegate('.tab', 'click', function(e) {
        var viewIdx = parseInt(this.getAttribute('data-id'), 10);

        var view = dmnModeler.getViews()[viewIdx];

        dmnModeler.open(view);
      });

      dmnModeler.on('views.changed', function(event) {

        var { views, activeView } = event;

        // clear tabs
        $tabs.empty();

        views.forEach(function(v, idx) {

          const className = CLASS_NAMES[v.type];

          var tab = $(`
            <div class="tab ${ v === activeView ? 'active' : ''}" data-id="${idx}">
              <span class="${ className }"></span>
              ${v.element.name || v.element.id}
            </div>
          `);

          $tabs.append(tab);
        });
      });

      /**
       * Save diagram contents and print them to the console.
       */
      function exportDiagram() {
		
        dmnModeler.saveXML({ format: true }, function(err, xml) {

          if (err) {
            return console.error('could not save DMN 1.1 diagram', err);
          }

          alert('DMN Diagram exported. Ready to Download !');

          //console.log('DIAGRAM', xml);
		  //document.open('data:Application/octet-stream,' + encodeURIComponent(xml));
		  const url = window.URL.createObjectURL(new Blob([xml], {type: 'text/plain'}));
		  
		  const a = document.createElement('a');
		  a.style.display = 'none';
		  a.href = url;
		  // the filename you want
		  a.download = 'digitalbroker.dmn';
		  document.body.appendChild(a);
		  a.click();
		  window.URL.revokeObjectURL(url);
		  
        });
      }

      /**
       * Open diagram in our modeler instance.
       *
       * @param {String} dmnXML diagram to display
       */
      function openDiagram(dmnXML) {
		
        // import diagram
        dmnModeler.importXML(dmnXML, function(err) {
			
          if (err) {
            return console.error('could not import DMN 1.1 diagram', err);
          }
		  var activeView = dmnModeler.getActiveView();

         if (activeView.type === 'drd') {

          var activeEditor = dmnModeler.getActiveViewer();

          // access active editor components
          var canvas = activeEditor.get('canvas');

          // zoom to fit full viewport
          canvas.zoom('fit-viewport');
		 }
		});
      }
	  
	  
      // load external diagram file via AJAX and open it
      $.get(diagramUrl, openDiagram, 'text');

      // wire save button
      $('#download').click(exportDiagram);
	
	  
    </script>
  </body>
</html>